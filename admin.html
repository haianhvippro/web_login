<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý tài khoản</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h2>Quản lý tài khoản</h2>

  <!-- Bảng danh sách tài khoản -->
  <table id="accountTable" class="form-section">
    <thead>
      <tr>
        <th>Tên đăng nhập</th>
        <th>Mật khẩu</th>
        <th>Email</th>
        <th>Ngày sinh</th>
        <th>Thao tác</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Modal xác nhận xóa -->
  <div id="confirmationModal" class="modal">
    <div class="modal-content">
      <h3>Nhập mật khẩu quản trị để xác nhận xóa tài khoản</h3>
      <input type="password" id="adminPasswordInput" placeholder="Mật khẩu quản trị" />
      <button onclick="confirmDelete()">Xác nhận</button>
      <button onclick="closeModal()">Hủy</button>
    </div>
  </div>
</div>

<script>
  const adminPassword = "admin123"; // Mật khẩu quản trị
  const sheetAPI = 'https://script.google.com/macros/s/AKfycbwOLUdtOHS8VZ-liNOVcq7Ihp7U9jRFOOrsPJpUfdPPQnjl3cJVNYzpbrYSekzLBPA/exec'; // Thay bằng link API của bạn

  let users = []; // Mảng lưu danh sách tài khoản
  let usernameToDelete = null;

  // Tải dữ liệu từ Google Sheets
  async function fetchUsers() {
    try {
      const response = await fetch(sheetAPI);
      const data = await response.json();
      users = data.users || []; // Giả sử dữ liệu trả về có dạng { users: [...] }
      displayUsers();
    } catch (error) {
      console.error('Không thể tải dữ liệu:', error);
    }
  }

  // Hiển thị dữ liệu ra bảng
  function displayUsers() {
    const table = document.getElementById('accountTable');
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';

    users.forEach(user => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${user.username}</td>
        <td>${user.password}</td>
        <td>${user.email}</td>
        <td>${user.dob}</td>
        <td><button onclick="showConfirmationModal('${user.username}')">Xóa</button></td>
      `;
      tbody.appendChild(row);
    });

    table.style.display = 'table';
  }

  // Hiện modal xác nhận xóa
  function showConfirmationModal(username) {
    document.getElementById('confirmationModal').style.display = 'flex';
    usernameToDelete = username;
  }

  function closeModal() {
    document.getElementById('confirmationModal').style.display = 'none';
  }

  // Xác nhận và xóa tài khoản
  async function confirmDelete() {
    const enteredPassword = document.getElementById('adminPasswordInput').value;
    if (enteredPassword === adminPassword) {
      await deleteAccount(usernameToDelete);
      closeModal();
      alert('✅ Tài khoản đã được xóa!');
    } else {
      alert('❌ Mật khẩu quản trị không đúng!');
    }
  }

  // Gửi yêu cầu xóa tài khoản lên Google Sheets
  async function deleteAccount(username) {
    try {
      await fetch(sheetAPI, {
        method: 'POST',
        body: JSON.stringify({ action: 'delete', username: username }),
        headers: {
          'Content-Type': 'application/json'
        }
      });
      fetchUsers(); // Reload lại danh sách sau khi xóa
    } catch (error) {
      console.error('Không thể xóa tài khoản:', error);
    }
  }

  // Khi trang web load
  window.onload = fetchUsers;
</script>

<style>
  /* Modal style */
  .modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
  }
  .modal input {
    margin: 10px 0;
    padding: 8px;
    width: 80%;
  }
  .modal button {
    margin: 5px;
    padding: 8px 16px;
    border: none;
    background-color: #28a745;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  .modal button:hover {
    background-color: #218838;
  }
</style>

</body>
</html>
